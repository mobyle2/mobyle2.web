"use strict";function preg_quote(a){return(a+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!<\>\|\:])/g,"\\$1")}function highlight(a,b){return a.replace(new RegExp("("+preg_quote(b)+")","gi"),"<b>$1</b>")}$(document).ready(function(){$("[data-toggle=offcanvas]").click(function(){$(".row-offcanvas").toggleClass("active")})}),angular.module("mobyle",["mobyle.filters","mobyle.services","mobyle.directives","mobyle.controllers","ngSanitize","ngRoute","ui.utils","ui.tinymce","ui.bootstrap","ngGrid"]).config(["$routeProvider","$logProvider",function(a,b){a.when("/services",{templateUrl:"views/services.html",controller:"ServicesCtrl"});var c={templateUrl:"views/serviceDetail.html",controller:"ServiceDetailCtrl",resolve:{service:function(a,c,d){var e=d.defer();return c.get({public_name:a.current.params.name},function(a){e.resolve(a)},function(c){b.error("service "+a.current.params.name+" not found!",c),e.reject("service "+a.current.params.name+" not found!")}),e.promise},sourceJob:function(){return null}}};a.when("/services/:name/:version?",c),a.when("/projects/:project/services/:name/:version?",c),a.when("/projects",{templateUrl:"views/projects.html",controller:"ProjectsCtrl"}),a.when("/datas",{templateUrl:"views/datas.html",controller:"DatasCtrl"}),a.when("/projects/:projectId",{templateUrl:"views/projectDetail.html",controller:"ProjectDetailCtrl"}),a.when("/jobs",{templateUrl:"views/jobs.html",controller:"JobsCtrl"});var d={templateUrl:"views/jobDetail.html",controller:"JobDetailCtrl",resolve:{job:function(a,c,d){var e=d.defer();return c.get({id:a.current.params.jobId},function(a){e.resolve(a)},function(c){b.error("job "+a.current.params.jobId+" not found!",c),e.reject("job "+a.current.params.jobId+" not found!")}),e.promise}}};a.when("/jobs/:jobId",d);var e={templateUrl:"views/serviceDetail.html",controller:"ServiceDetailCtrl",resolve:{sourceJob:function(a,c,d){var e=d.defer();return c.get({id:a.current.params.jobId},function(a){e.resolve(a.getReplayJob())},function(c){b.error("job "+a.current.params.jobId+" not found!",c),e.reject("job "+a.current.params.jobId+" not found!")}),e.promise},service:function(){return null}}};a.when("/jobs/:jobId/replay",e),a.when("/dataterms",{templateUrl:"views/terms.html",controller:"DataTermsCtrl"}),a.when("/dataterms/:dataTermId",{templateUrl:"views/termDetail.html",controller:"DataTermDetailCtrl"}),a.when("/formatterms",{templateUrl:"views/terms.html",controller:"FormatTermsCtrl"}),a.when("/formatterms/:formatTermId",{templateUrl:"views/termDetail.html",controller:"FormatTermDetailCtrl"}),a.when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}),a.when("/logout",{templateUrl:"views/login.html",controller:"LoginCtrl"}),a.when("/my",{templateUrl:"views/my.html",controller:"LoginCtrl"}),a.when("/my/password_reset",{templateUrl:"views/my_password_reset.html",controller:"LoginCtrl"}),a.when("/dashboard",{templateUrl:"views/my.html",controller:"LoginCtrl"}),a.when("/notificationcenter",{templateUrl:"views/notificationcenter.html",controller:"NotificationCenterCtrl"}),a.otherwise({redirectTo:"/services"})}]),angular.module("mobyle.controllers",[]),angular.module("mobyle.controllers").controller("NotificationCtrl",["$scope","$interval","Notification","CurrentUser",function(a,b,c,d){a.notifications=[],a.listDisplay="list",a.object="notification",b(function(){var b=d.get();void 0!==b.email&&(a.notifications=c.filter({read:!1}))},1e4),a.read=function(a){a.read=!0,c.update(a)}}]),angular.module("mobyle.controllers").controller("NotificationCenterCtrl",["$scope","$interval","$routeParams","Notification","NotificationList","Project","CurrentUser",function(a,b,c,d,e,f,g){a.notifications=[],a.user=g.get(),void 0!==a.user.email&&(a.notifications=d.query()),a.listDisplay="list",a.object="notification",a.show="unread",a.message="",a.notification={sendall:!1,project:null,message:"",type:1},a.projects=f.query(),a.display=function(b){a.show=b},a.update=function(){a.notifications=d.query()},a.send=function(){a.notification.type=a.notification.sendall?0:1,e.notify(a.notification),a.alerts.push({type:"danger",msg:"message sent"})},a.read=function(b){b.read=!0,d.update(b),a.update()},a.mark_all_read=function(){for(var b=[],c=a.notifications.length,d=0;c>d;d++)a.notifications[d].read||b.push(a.notifications[d]._id.$oid);e.read_list(b)},a.delete_all=function(b){var c=[],d=!0;"unread"===b&&(d=!1);for(var f=a.notifications.length,g=0;f>g;g++)a.notifications[g].read===d&&c.push(a.notifications[g]._id.$oid);e.delete_list(c)},a.delete=function(b){b.$delete().then(function(){a.notifications.splice(a.notifications.indexOf(b),1)},function(b){a.alerts.push({type:"danger",msg:b.data.detail})})},b(function(){a.user=g.get(),void 0!==a.user.email&&(a.notifications=d.query())},2e4)}]),angular.module("mobyle.controllers").controller("LoginCtrl",["LoginManager","$routeParams","$scope","$location","Login","Logout","PasswordResetRequest","PasswordReset","Project","CurrentProject",function(a,b,c,d,e,f,g,h,i,j){c.logins=["native","facebook","openid","twitter","github","persona","google"],c.User=null,c.login=null,c.password=null,c.admin=!1,c.currentProject=j.get(),c.$on("CurrentProject.update",function(a,b){c.currentProject=b}),c.setCurrentProjectId=function(a){j.setId(a)},c.token=b.token,c.resetPassword=function(){if(c.rpassword===c.rpassword2){var a=new h(c.token,c.rpassword);a.get({},function(){c.msg="Your password has been updated, you can login with your new password"}),c.rpassword=null,c.provider="native"}else c.msg="Passwords are not identical"},c.isAdmin=function(){return c.admin},c.alreadyLogged=function(){var b=new e("native"),d=b.get({username:c.login,password:c.password},function(){a.result(d.user,d.msg,d.status,d.admin,d.default_project)})},c.$on("LoginManager.update",function(a,b){c.msg=b.msg,c.admin=b.admin,0===b.status?("register"===c.provider&&(c.provider="native"),c.password=null,c.rpassword=null,c.rpassword2=null,c.setUser(b.user),j.setId(b.defaultProjectId)):(c.User=null,j.setId(null)),c.admin=b.admin}),c.rlogin=null,c.rpassword=null,c.rpassword2=null,c.provider="native",c.isProvider=function(a){return a===c.provider},c.setUser=function(a){c.User=a,"/login"===d.path()&&d.path("/")},c.userLogged=function(){return null!==c.User},c.signIn=function(b){c.msg="",c.provider=b;var d,f;"persona"===b?navigator.id.request():"register"===b?c.rpassword===c.rpassword2?(d=new e("register"),f=d.get({username:c.rlogin,password:c.rpassword},function(){a.result(f.user,f.msg,f.status,f.admin,f.default_project)})):c.msg="Passwords are not identical":"native"===b?(d=new e("native"),f=d.get({username:c.login,password:c.password},function(){a.result(f.user,f.msg,f.status,f.admin,f.default_project)})):"google"===b||"openid"===b||"facebook"===b||"reset"===b||console.error("not yet implemented")},c.signOut=function(){"persona"===c.provider?navigator.id.logout():(new f).get(),c.setUser(null),c.provider=null,d.path("/login")},c.remember=function(a){var b=new g(c.rlogin);b.get({},function(){c.msg="A request has been sent, you will receive soon an email at the provided address to reset your password"}),a.preventDefault()},c.register=function(a){c.provider="register",a.preventDefault()}}]),angular.module("mobyle.controllers").controller("ServicesCtrl",["$scope","Service",function(a,b){a.services=b.query(),a.listDisplay="list"}]),angular.module("mobyle.controllers").controller("ServiceDetailCtrl",["$scope","$window","$routeParams","$location","mbsimple","service","sourceJob","Job","CurrentProject",function(a,b,c,d,e,f,g,h,i){a.reset=function(){g?(a.service=g.service,a.job=g,a.job.project=i.get()):(a.service=f,a.job=new h,a.job.project=i.get(),a.job.service=a.service,a.job.inputs={},a.job.outputs={}),a.showAdvanced=e(a.service.inputs)},a.mbsimple=e,a.submit=function(){a.job.$save().then(function(){d.path("/jobs/"+a.job._id.$oid)})},a.reset()}]),angular.module("mobyle.controllers").controller("DataTermsCtrl",["$scope","DataTerm",function(a,b){a.terms=b.query(),a.listDisplay="list",a.object="dataterm"}]),angular.module("mobyle.controllers").controller("DataTermDetailCtrl",["$scope","$routeParams","DataTerm",function(a,b,c){a.term=c.get({id:b.dataTermId}),a.object="dataterm"}]),angular.module("mobyle.controllers").controller("FormatTermsCtrl",["$scope","FormatTerm",function(a,b){a.terms=b.query(),a.listDisplay="list",a.object="formatterm"}]),angular.module("mobyle.controllers").controller("FormatTermDetailCtrl",["$scope","$routeParams","FormatTerm",function(a,b,c){a.term=c.get({id:b.formatTermId}),a.object="formatterm"}]),angular.module("mobyle.controllers").controller("ProjectsCtrl",["$scope","$log","$modal","Project","$templateCache",function(a,b,c,d,e){a.update=function(){b.info("querying list of projects..."),a.projects=d.query()},a.projectGridOptions={data:"projects",enableRowSelection:!1,columnDefs:[{field:"name",displayName:"Name",width:"*",cellTemplate:e.get("projectsGrid_NameCell.html")},{field:'getCreationDate() | date: "MMM d, y H:mm"',displayName:"Creation date",width:"*"},{field:"description",displayName:"Description",width:"***",cellTemplate:e.get("projectsGrid_DescriptionCell.html")}]},a.delete=function(b){b.$delete().then(function(){a.projects.splice(a.projects.indexOf(b),1)},function(b){a.alerts.push({type:"danger",msg:b.data.detail})})},a.edit_dialog=function(b){var d=c.open({templateUrl:"views/projectEditPropertiesModal.html",controller:"ProjectEditPropertiesCtrl",resolve:{project:function(){return b}}});d.result.then(function(c){b?b=c:a.projects.push(c)})},a.update()}]),angular.module("mobyle.controllers").controller("JobsCtrl",["$scope","$log","$modal","$routeParams","Job","CurrentProject","$templateCache",function(a,b,c,d,e,f,g){a.project=f.get(),a.update=function(){a.project.$promise.then(function(){a.projectJobs=e.list_by_project({project_id:f.get()._id.$oid})})},a.projectDataGridOptions={data:"projectJobs",enableRowSelection:!1,columnDefs:[{field:"_id.$oid",displayName:"name",width:"**",cellTemplate:g.get("jobsGrid_NameCell.html")},{field:"_id.$oid",displayName:"ID",width:"**"},{field:'getCreationDate() | date: "MMM d, y H:mm"',displayName:"Creation date",width:"*"},{field:"status",displayName:"Status",width:"*",cellTemplate:g.get("jobsGrid_StatusCell.html")}]},a.deleteJob=function(b){b.$delete().then(function(){a.projectJobs.splice(a.projectJobs.indexOf(b),1)},function(b){a.alerts.push({type:"danger",msg:b.data.detail})})},a.update(),a.$on("CurrentProject.update",function(b,c){a.project=c,a.update()})}]),angular.module("mobyle.controllers").controller("JobDetailCtrl",["$scope","job","mbset",function(a,b,c){a.job=b,a.mbset=c,a.showAdvanced=!0}]),angular.module("mobyle.controllers").controller("ProjectEditPropertiesCtrl",["$scope","$log","$modalInstance","Project","CurrentUser","project",function(a,b,c,d,e,f){b.info("editing "+(f?"project "+f.name:" new project")),f?(b.info(a.project),a.project=f):(a.project=new d,a.project.name="new project"),a.ok=function(){f||(a.project.owner=e.get()._id.$oid,a.project.users=[{role:"manager",user:a.project.owner}]),a.project.$save().then(function(){c.close(a.project)})},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("mobyle.controllers").controller("DatasCtrl",["$scope","$log","$modal","$routeParams","$window","CurrentProject","ProjectData","$templateCache",function(a,b,c,d,e,f,g,h){a.project=f.get(),a.update=function(){a.project.$promise.then(function(){a.projectData=g.list_by_project({project_id:a.project._id.$oid})})},a.projectDataGridOptions={data:"projectData",enableRowSelection:!1,columnDefs:[{field:"name",displayName:"Name",width:"*"},{field:"description",displayName:"Description",width:"**"},{field:"tags",displayName:"Tags",cellTemplate:h.get("projectDataGrid_TagCell.html"),width:"*"},{field:"data.size",displayName:"Size",cellTemplate:h.get("projectDataGrid_DataSizeCell.html"),width:"*"},{field:"data.type",displayName:"Type (format)",width:"**",cellTemplate:h.get("projectDataGrid_DataTypeCell.html")},{field:"test",displayName:"Actions",width:"**",cellTemplate:h.get("projectDataGrid_ActionsCell.html")}]},a.viewData=function(a){e.open("/api/projectdata/"+a._id.$oid+"/raw")},a.downloadData=function(a){e.open("/api/projectdata/"+a._id.$oid+"/dl")},a.deleteData=function(b){b.$delete().then(function(){a.projectData.splice(a.projectData.indexOf(b),1)},function(b){a.alerts.push({type:"danger",msg:b.data.detail})})},a.addProjectData=function(b,d){var e=c.open({templateUrl:"views/dataEdit.html",controller:"DataEditCtrl",resolve:{data:function(){return b},project:function(){return d}}});e.result.then(function(c){b?b=c:a.projectData.push(c)})},a.editProjectData=function(b,d){var e=c.open({templateUrl:"views/dataEdit.html",controller:"DataEditCtrl",resolve:{data:function(){return b},project:function(){return d}}});e.result.then(function(c){b?b=c:a.projectData.push(c)})},a.update(),a.$on("CurrentProject.update",function(b,c){a.project=c,a.update()})}]),angular.module("mobyle.controllers").controller("DataEditCtrl",["$scope","$log","$modalInstance","ProjectData","CurrentUser","data","project","ServiceTypeTermRegistry",function(a,b,c,d,e,f,g,h){b.info("editing "+(f?"data "+f.name:" new data for project "+g)),a.project=g,a.alerts=[],h.dataTerms().then(function(b){a.data_format_terms=b}),a.currentDataTerm={},f?a.data=f:(a.data=new d,a.data.project=g._id.$oid,a.data.name="new data",a.data.tags=[],a.mode="paste",a.data.data={type:{}}),a.resetFormat=function(){a.data.data.type.format_terms=null},a.ok=function(){a.data.data.type.data_terms=a.currentDataTerm.term_id,a.data.$save().then(function(){c.close(a.data)},function(b){a.alerts.push({type:"danger",msg:b.data.detail})})},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("mobyle.controllers").controller("DataSelectCtrl",["$scope","$log","$modalInstance","ProjectData","para","CurrentProject",function(a,b,c,d,e,f){a.para=e,a.project=f.get(),a.pagedProjectData=[],a.setPagingData=function(b,c,d){a.pagedProjectData=b.slice((d-1)*c,d*c),console.log(a.projectData),console.log(a.pagedProjectData),a.$$phase||a.$apply()},a.pagingOptions={pageSizes:[5,10,20],pageSize:5,currentPage:1},a.project.$promise.then(function(){a.projectData=d.list_by_project({project_id:a.project._id.$oid}),a.projectData.$promise.then(function(){a.setPagingData(a.projectData,a.pagingOptions.pageSize,a.pagingOptions.currentPage)}),a.totalServerItems=a.projectData.length}),a.$watch("pagingOptions",function(){a.setPagingData(a.projectData,a.pagingOptions.pageSize,a.pagingOptions.currentPage)},!0),a.selectedRows=[],a.projectDataGridOptions={data:"pagedProjectData",showFooter:!0,totalServerItems:"totalServerItems",enablePaging:!0,pagingOptions:a.pagingOptions,enableRowSelection:!0,multiSelect:!1,columnDefs:[{field:"name",displayName:"Name",width:"*"},{field:"description",displayName:"Description",width:"**"}],selectedItems:a.selectedRows},a.ok=function(){c.close(a.selectedRows)},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("mobyle.controllers").controller("mobyleCtrl",["$rootScope",function(a){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.$on("$routeChangeError",function(b,c,d,e){a.alerts.push({type:"danger",msg:e||"unknown navigation error"})})}]),function(){angular.module("mobyle.directives",[]),angular.module("mobyle.directives").directive("activeLink",["$location",function(a){return{restrict:"A",link:function(b,c,d){var e=d.activeLink,f=d.href;f=f.substring(1),b.location=a,b.$watch("location.path()",function(a){f===a?c.parent().addClass(e):c.parent().removeClass(e)})}}}]),angular.module("mobyle.directives").directive("hiddable",function(){return{restrict:"A",link:function(a,b){b.css("position","relative"),b.css("border-right","1px solid #e5e5e5");var c=b.next(),d=$('<i class="glyphicon glyphicon-chevron-left"></i>'),e=$('<button class="btn" style="width: 2em; position: absolute; top:0em; right: -2em; padding: 0;"></button>');b.append(e),e.append(d);var f;e.click(function(){f=b.width(),b.children().css("overflow","hidden"),b.toggleClass("col-md-2 col-md-0"),c.toggleClass("col-md-10 col-md-11"),d.toggleClass("glyphicon glyphicon-chevron-right glyphicon glyphicon-chevron-left")})}}}),angular.module("mobyle.directives").directive("mboutput",[function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"views/mboutput.html",scope:{para:"=",job:"="},link:function(a,b){switch(a.para.type._type){case"StringType":case"FloatType":case"IntegerType":case"BooleanType":a.displayType="text",a.para.type.options&&a.para.type.options.length>0?angular.forEach(a.para.type.options,function(b){b.value===a.job.inputs[a.para.name].value&&(a.text=b.label)}):a.text=a.job.inputs[a.para.name].value;break;case"FormattedType":a.displayType="file";break;default:a.untranslated=!0}var c=b.find("[data-content]");c.bind("mouseover",function(){c.popover("show")}),c.bind("mouseout",function(){c.popover("hide")})}}}]),angular.module("mobyle.directives").directive("mbinput",["evalBoolFactory","$modal",function(a,b){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"views/mbinput.html",scope:{para:"=",job:"="},link:function(c,d){switch(c.para.type._type){case"StringType":c.para.type.options&&c.para.type.options.length>0?(c.select=!0,c.options=[],c.para.type.options.forEach(function(a){c.options.push({label:a.label,value:a.value})})):c.itype="text";break;case"FloatType":c.itype="number",c.step="any";break;case"IntegerType":c.itype="number",c.step="1";break;case"BooleanType":c.select=!0,c.options=[{label:"yes",value:!0},{label:"no",value:!1}];break;case"FormattedType":c.textarea=!0;break;default:c.untranslated=!0}c.textarea&&(c.selectBookmark=function(){var a=b.open({templateUrl:"views/dataSelect.html",controller:"DataSelectCtrl",resolve:{para:function(){return c.para}}});a.result.then(function(a){a&&(c.job.inputs[c.para.name]=a[0]._id.$oid)})}),c.job.inputs[c.para.name]||(c.job.inputs[c.para.name]=c.para.type.default),c.uiValidateString="",c.para.ctrl&&(c.uiValidateObj={},$.each(c.para.ctrl,function(b,d){c["ctrls"+b]={test:function(b){return c.job.inputs.value=b,c.job.inputs[c.para.name]=b,console.log(c.para.name,b,c.para.type.default,a(c.job.inputs,c.para.name)(d.test)),a(c.job.inputs,c.para.name)(d.test)},message:d.message},c.uiValidateObj["ctrls"+b]="ctrls"+b+".test($value)"}),c.uiValidateString=JSON.stringify(c.uiValidateObj));var e=d.find("[data-content]");e.bind("mouseover",function(){e.popover("show")}),e.bind("mouseout",function(){e.popover("hide")})}}}]),angular.module("mobyle.directives").directive("ifPrecond",["evalBoolFactory",function(a){return{restrict:"A",link:function(b,c){var d=a(b.job.inputs),e=b.para.mandatory,f=function(a){var f=d(a);f?c.show():c.hide(),b.para.mandatory=e&&f};b.$watch("job.inputs",function(){f(b.para.precond)},!0)}}}]),angular.module("mobyle.directives").directive("recursive",["$compile",function(a){return{restrict:"E",priority:1e5,compile:function(b){var c,d=b.contents().remove();return function(b,e){c||(c=a(d)),e.append(c(b,function(a){return a}))}}}}]),angular.module("mobyle.directives").directive("mbformpara",["mbsimple",function(a){return{scope:{para:"=",job:"=",showAdvanced:"="},link:function(b){b.mbsimple=a},templateUrl:"views/mbformpara.html"}}]),angular.module("mobyle.directives").directive("mbjobpara",["mbset",function(a){return{scope:{para:"=",job:"="},link:function(b){b.mbset=a},templateUrl:"views/mbjobpara.html"}}]),angular.module("mobyle.directives").directive("servicesClassification",[function(){return{restrict:"E",replace:!0,scope:{},templateUrl:"views/classification.html",controller:["$scope","Classification",function(a,b){var c=function(a){return a.services.map(function(a){return a.name}).concat(a.sublevels.map(function(a){return c(a)}).reduce(function(a,b){return a.concat(b)},[]))};a.getServicesNumber=function(a){return _.unique(c(a)).length},a.load=function(c){a.loading=!0,a.tree=null,a.defaultToggleState=!c,b.query({key:"topic",filter:c},function(b){a.tree=b,a.loading=!1})},a.load(),a.$watch("query",function(b,c){(c&&!(c.length<3)||b&&!(b.length<3))&&a.load(!b||b.length<3?null:b)})}]}}]),angular.module("mobyle.directives").directive("tree",[function(){return{templateUrl:"views/tree.html",link:function(a){a.isService=function(a){return a.hasOwnProperty("version")},a.toggleState=a.defaultToggleState,a.toggle=function(){a.toggleState=!a.toggleState}}}}]),angular.module("mobyle.directives").directive("typeText",["ServiceTypeTermRegistry",function(a){return{restrict:"E",replace:!0,template:'<span>{{dataTermLabel}} <span ng-if="formatTermLabel">({{formatTermLabel}})</span></span>',scope:{type:"="},link:function(b){b.dataTermLabel="",b.formatTermLabel="",a.dataTermsById().then(function(a){var c=$.makeArray(b.type.data_terms);b.dataTermLabel=$.map(c,function(b){return a[b]?a[b].name:b}).join(", ")}),a.formatTermsById().then(function(a){var c=$.makeArray(b.type.format_terms);b.formatTermLabel=$.map(c,function(b){return a[b]?a[b].name:b}).join(", ")})}}}]),angular.module("mobyle.directives").directive("tinyTextFile",[function(){return{restrict:"E",replace:!0,require:"ngModel",scope:{ngModel:"="},template:'<span class="btn-file btn">Load file...<input type="file" /></span>',link:function(a,b){var c=function(b){for(var c,d="",e=b.target.files,f=2e4,g=function(b,c){var e=c+f-1;e>i-1&&(e=i-1);var h=new FileReader;h.onloadend=function(h){h.target.readyState===FileReader.DONE&&(d+=h.target.result,i-1>e?(c+=f,h=null,g(b,c)):a.$apply(function(){a.ngModel.value=d,a.ngModel.name=b.name,a.ngModel.data.size=b.size}))};var j=b.slice(c,e+1);h.readAsBinaryString(j)},h=0;h===e.length;h++){c=e[h];var i=c.size;g(c,0)}};b.children().change(function(a){c(a)})}}}]),angular.module("mobyle.directives").directive("input",function(){return{restrict:"E",require:"?ngModel",link:function(a,b,c,d){"number"===c.type.toLowerCase()&&d.$formatters.push(function(a){return a?parseFloat(a):null})}}})}(),angular.module("mobyle.filters",[]).filter("kwSearch",function(){return function(a,b,c,d){if(!b||b.length<3)return a;for(var e=[],f=0;f<a.length;f++){for(var g=angular.copy(a[f]),h=0;h<c.length;h++)g[c[h]]&&(!d&&-1!==g[c[h]].indexOf(b)||d&&-1!==g[c[h]].toUpperCase().indexOf(b.toUpperCase()))&&(g[c[h]+"Hl"]=d?highlight(g[c[h]],b):g[c[h]].replace(b,"<strong>"+b+"</strong>","g"),g.found=!0);g.found&&e.push(g)}return e}}),angular.module("mobyle.filters").filter("humanSize",function(){return function(a){if(0>=a)return 0;var b=["bytes","kB","MB","GB","TB","PB"],c=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(c))).toFixed(2)+" "+b[c]}}),angular.module("mobyle.services",["ngResource"]),angular.module("mobyle.services").value("mbsimple",function(a){function b(a){return a?a.children?a.children.filter(b).length>0:a.simple===!0:!1}return b(a)}),angular.module("mobyle.services").value("mbset",function(a,b){function c(a){return a?a.children?a.children.filter(c).length>0:b[a.name]&&(b[a.name].data||b[a.name].value)?!0:!1:!1}return b?c(a):!1}),angular.module("mobyle.services").factory("mfResource",["$resource","$http",function(a,b){function c(c,d,e){var f="/"+c.toLowerCase()+"s/:id",g="/"+c.toLowerCase()+"s?";for(var h in d)g+="Search"+c+"["+h+"]=:"+h+"&";var i=function(){return function(a){var b={},d=function(a,c){if(c instanceof Array)$.each(c,function(b){d(a+"["+b+"]",c[b])});else if(c instanceof Object)if(c.$oid)b[a]=c.$oid;else for(var e in c)c.hasOwnProperty(e)&&d(a+"["+e+"]",c[e]);else null!==c&&(b[a]=c)};return d(c,a),$.param(b)}},j=function(a){var b=JSON.parse(a);return b[b.object]},k={headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"PUT",transformRequest:i(""),transformResponse:j},l={headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",transformRequest:i(""),transformResponse:j,params:{}},m={headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"GET",transformRequest:i(""),isArray:!0},n={url:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"GET",transformRequest:i("Search"),isArray:!0},o=a(f,d||{},$.extend({get:{method:"GET",transformResponse:function(a){var b=JSON.parse(a);return b[b.object]}},list:m,filter:n,create:l,update:k},e));return o.prototype.$save=function(){return this._id?this.$update():this.$create()},o.prototype.getCreationDate=function(){if(this._id){var a=this._id.$oid,b=a.substring(0,8),c=parseInt(b,16),d=new Date(1e3*c);return d}return null},o.prototype.$delete=function(){return b.delete("/"+c.toLowerCase()+"s/"+this._id.$oid)},o}return c}]),angular.module("mobyle.services").factory("Classification",["$resource",function(a){return a("/services/by_:key",{},{query:{isArray:!1}})}]),angular.module("mobyle.services").value("serviceInputsByName",function(){var a={},b=function(c){c.children?angular.forEach(c.children,function(a){b(a)}):a[c.name]=c};return b(this.inputs),a}),angular.module("mobyle.services").factory("Service",["$resource","serviceInputsByName",function(a,b){var c=a("/services/:id",{},{get:{method:"get",url:"/api/services/:id/:public_name/:version",transformResponse:function(a){var b=JSON.parse(a);return b[b.object]}}});return c.prototype.inputsByName=b,c}]),angular.module("mobyle.services").factory("DataTerm",["mfResource",function(a){return a("DataTerm")}]),angular.module("mobyle.services").factory("FormatTerm",["mfResource",function(a){return a("FormatTerm")}]),angular.module("mobyle.services").factory("ServiceTypeTerm",["mfResource",function(a){var b=a("ServiceTypeTerm");return b}]),angular.module("mobyle.services").factory("ServiceTypeTermRegistry",["ServiceTypeTerm","FormatTerm","$q",function(a,b,c){var d=c.defer(),e=c.defer(),f=c.defer(),g=c.defer(),h=c.defer(),i=c.defer(),j=a.query({});return j.$promise.then(function(a){var b={},c={},j={},k=[],l=[],m=[];angular.forEach(a,function(a){b[a.term_id]=a,k.push(a),m.push(a),angular.forEach(a.format_terms,function(a){c[a.term_id]||(c[a.term_id]=a,l.push(a),m.push(a))})}),j=b,angular.extend(j,c),d.resolve(b),e.resolve(c),f.resolve(j),g.resolve(k),h.resolve(l),i.resolve(m)}),{dataTermsById:function(){return d.promise},formatTermsById:function(){return e.promise},termsById:function(){return f.promise},dataTerms:function(){return g.promise},formatTerms:function(){return h.promise},terms:function(){return i.promise}}}]),angular.module("mobyle.services").factory("User",["mfResource",function(a){return a("User")}]),angular.module("mobyle.services").factory("Project",["mfResource",function(a){var b={name:"@name",description:"@description","public":"@public",owner:"@owner",users:"@users",id:"@_id.$oid"};return a("Project",b)}]),angular.module("mobyle.services").factory("Job",["mfResource","$http","$parse","Service","serviceInputsByName",function(a,b,c,d,e){var f={id:"@_id.$oid",status:"@status",project:"@project._id.$oid",service:"@service._id.$oid"},g=a("Job",f,{list_by_project:{method:"GET",url:"/api/project/:project_id/jobs",isArray:!0},get:{method:"get",url:"/api/jobs/:id"}});return g.prototype.$create=function(){var a=this;return b.post("/api/projectjobs",this,{transformRequest:function(a){var b=new FormData;b.append("project",a.project._id.$oid),b.append("service",a.service._id.$oid);var d=a.service.inputsByName();return angular.forEach(a.inputs,function(e,f){if(null!==e&&d[f]&&(null===d[f].type.default||d[f].type.default&&e!==d[f].type.default)){var g=e&&e.charAt&&"@"===e.charAt(0)?c(e.substr(1))(a):e;b.append("input:"+f,g)}}),b},transformResponse:function(a){var b=new g(angular.fromJson(a));return b},headers:{"Content-Type":void 0}}).success(function(b){a._id=b._id})},g.prototype.userName=function(){return this.name?this.name:this.service.public_name},g.prototype.getReplayJob=function(){var a={};angular.copy(this,a),delete a._id;var b={};return a.service.inputsByName=e,angular.forEach(a.inputs,function(a,c){if(null!==a&&a.type&&(null===a.type.default||a.type.default&&a.value!==a.type.default))switch(a.type._type){case"IntegerType":b[c]=parseInt(a.value,10);break;case"FloatType":b[c]=parseFloat(a.value);break;default:b[c]=a.value}}),a.inputs=b,a},g}]),angular.module("mobyle.services").factory("ProjectData",["mfResource","$http","$parse",function(a,b,c){var d={name:"@name",description:"@description",project:"@project",tags:"@tags",id:"@_id.$oid",value:"@value",format_terms:"@data.type.format_terms",data_terms:"@data.type.data_terms"},e=a("ProjectData",d,{update:{method:"PUT",url:"/api/projectdata/:id"},list_by_project:{method:"GET",url:"/api/project/:project_id/data",isArray:!0}});return e.prototype.$create=function(){var a=this;return b.post("/api/projectdata",this,{transformRequest:function(a){var b=new FormData;return angular.forEach(d,function(d,e){var f=d&&d.charAt&&"@"===d.charAt(0)?c(d.substr(1))(a):d;b.append(e,f)}),b},transformResponse:function(a){var b=new e(angular.fromJson(a));return b},headers:{"Content-Type":void 0}}).success(function(b){a._id=b._id})},e}]),angular.module("mobyle.services").factory("CurrentProject",["Project","$rootScope",function(a,b){function c(c){e=a.get({id:c}),b.$broadcast("CurrentProject.update",e)}function d(){return e}var e={};return{setId:c,get:d}}]),angular.module("mobyle.services").factory("CurrentUser",["User","LoginManager","$rootScope","$log",function(a,b,c,d){var e=new a,f=function(b){d.info("load current user info for "+b),a.query({email:b},function(a){e=a[0],d.debug(a),d.info("current user loaded: "+e.email)})};c.$on("LoginManager.update",function(a,b){f(b.email)}),f(b.login.user);var g=function(){return d.info("returning current user :"+e.email),e};return{get:g}}]),angular.module("mobyle.services").factory("Login",["$resource",function(a){function b(b){return a("/auth/login/"+b,{},{})}return b}]),angular.module("mobyle.services").factory("Logout",["$resource",function(a){function b(){return a("/auth/logout",{},{})}return b}]),angular.module("mobyle.services").factory("PasswordResetRequest",["$resource",function(a){function b(b){return a("/auth/password/reset",{username:b},{})}return b}]),angular.module("mobyle.services").factory("PasswordReset",["$resource",function(a){function b(b,c){return a("/auth/password",{token:b,password:c},{})}return b}]),angular.module("mobyle.services").factory("LoginManager",["$rootScope",function(a){return{login:{user:null,msg:"",status:0,admin:!1,default_project:null},result:function(b,c,d,e,f){this.login.user=b,this.login.msg=c,this.login.status=d,this.login.admin=e,this.login.defaultProjectId=f,a.$broadcast("LoginManager.update",this.login)}}}]),angular.module("mobyle.services").factory("NotificationList",["mfResource","$http",function(a,b){return{read_list:function(a){b.put("/api/notifications/list",{list:a,read:!0},{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},delete_list:function(a){b.post("/api/notifications/delete",{list:a},{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},notify:function(a){b.post("/api/notifications/list",{project:a.project._id.$oid,notification:a},{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}}]),angular.module("mobyle.services").factory("Notification",["mfResource",function(a){return a("Notification",{id:"@_id.$oid",read:"@read",user:"@user",message:"@message",type:"@type"},{})}]),angular.module("mobyle.services").value("evalBoolFactory",function(a){var b=function(c){if(!c)return!0;var d=!0;return"string"==typeof c?d=Boolean(a[c]):$.each(c,function(c,e){if(a.hasOwnProperty(c))switch(typeof e){case"number":case"string":case"boolean":case"undefined":d=a[c]!==e?!1:!0;break;case"object":$.each(e,function(b,e){switch(b){case"#gt":d=Number(a[c])>Number(e);break;case"#gte":d=Number(a[c])>=Number(e);break;case"#lt":d=Number(a[c])<Number(e);break;case"#lte":d=Number(a[c])<=Number(e);break;case"#in":d=-1!==$.inArray(a[c],e);break;case"#nin":d=-1===$.inArray(a[c],e);break;case"#ne":d=a[c]!==e}return d?void 0:!1})}else switch(c){case"#or":d=!1,$.each(e,function(a,c){return b(c)?(d=!0,!1):void 0});break;case"#and":d=!0,$.each(e,function(a,c){return b(c)?void 0:(d=!1,!1)});break;case"#not":d=!b(e);
break;case"#nor":d=!0,$.each(e,function(a,c){return b(c)?(d=!1,!1):void 0})}return d}),d};return b});